import fs from 'fs'
import moment from 'moment'
import requestUtil from '../utils/request-util'
import listUtil from '../utils/list-util'
import LCSSSmsUtil from '../utils/lcss-sms-util'

const testSendMail = async (fastify) => {
  const sendMailResult = await fastify.nodemailer.sendMail({
    receiver: ['576507045@qq.com'],
    subject: 'Test sending email by nodeJS',
    text: `Hello! This is a test email sent by nodeJS.`
  })
  logger.debug('sendMailResult =', sendMailResult)
}

const testRedis = async (fastify) => {
  logger.debug(await fastify.redis.store({keyPrefix: 'case_', key: '1', objVal: {a: 'a', case_id: '1'}}))
  logger.debug(await fastify.redis.store({keyPrefix: 'case_', key: '2', objVal: {b: 'b', case_id: '2'}}))
  logger.debug(await fastify.redis.get({keyPrefix: 'case_', key: '2'}))
  logger.debug(await fastify.redis.multiGet({keyPrefix: 'case_', key: ['2', '3']}))
  logger.debug(await fastify.redis.del({keyPrefix: 'case_', key: '41415'}))

  // await fastify.redis.flushall()
}

export default async (fastify) => {
  const mobiles = [
    '13600432903',
    '13584083823',
    '13125132177',
    '15602999662',
    '15821187263',
    '18616270975',
    '13951611461',
    '18601339235',
    '13665095080',
    '18601042162',
    '13851798323',
    '18210318784',
    '13636399782',
    '18151010777',
    '13661555250',
    '13910024132',
    '13701095418',
    '17714050382',
    '13661166933',
    '15972986360',
    '13917117573',
    '13761834696',
    '18601186298',
    '18521500966',
    '15288207802',
    '18681581592',
    '13901208615',
    '18602747572',
    '13810923988',
    '13818398700',
    '18610086215',
    '13816374343',
    '15000423335',
    '13552255171',
    '15010410639',
    '13801888482',
    '13510307579',
    '13521363055',
    '18971361190',
    '13641253275',
    '13585165010',
    '13601724790',
    '15650724501',
    '13911895325',
    '13811693072',
    '13918065587',
    '13381699069',
    '13641988693',
    '15651612396',
    '13621164381',
    '15073121338',
    '18610789211',
    '13501169893',
    '15062251523',
    '15921169466',
    '13437276867',
    '13311001597',
    '13538003921',
    '15013832071',
    '13621018522',
    '13817828717',
    '13816365017',
    '18621962217',
    '13917926559',
    '18610296349',
    '13761903735',
    '13533556888',
    '13693271827',
    '13817975469',
    '13691435860',
    '18616613820',
    '13528863366',
    '13924088110',
    '18918624686',
    '13818199659',
    '18301664651',
    '18916058285',
    '18670375005',
    '13636509697',
    '13810045763',
    '13801012228',
    '18871520451',
    '15117559822',
    '13813977018',
    '13815634712',
    '13512711016',
    '15111230990',
    '18511216611',
    '18906050156',
    '13917103699',
    '15878733570',
    '13601380822',
    '13574168089',
    '17315586777',
    '18121163885',
    '13918713425',
    '18616940043',
    '13720015618',
    '13826590267',
    '18918296856',
    '18669070513',
    '13816541702',
    '13869416230',
    '13916766782',
    '18798042059',
    '13851801330',
    '17763648718',
    '15910578382',
    '15802713328',
    '13770533999',
    '13800000000',
    '18916611093',
    '13911996808',
    '18675558103',
    '18610601039',
    '18907191517',
    '15211005197',
    '13584027753',
    '15001079254',
    '18610016700',
    '18373858566',
    '17136671466',
    '18616569538',
    '18911381105',
    '15751833353',
    '12345678900',
    '18611910677',
    '18638501725',
    '13501756621',
    '13810569291',
    '15921178003',
    '18933934625',
    '15001266824',
    '13678922288',
    '13520821687',
    '13554089429',
    '18516890640',
    '13811224605',
    '13427908910',
    '15974199411',
    '18201300966',
    '18901367562',
    '15380062888',
    '15692116033',
    '18721767980',
    '13816687578',
    '13851599659',
    '13774332696',
    '15011538240',
    '13811861826',
    '15715193855',
    '13816658600',
    '17708479320',
    '15925785853',
    '18948480888',
    '13450715512',
    '18601697789',
    '13824399864',
    '18827081103',
    '15226080225',
    '13888537117',
    '13031182040',
    '13574867015',
    '13027771290',
    '18911832128',
    '13683073761',
    '13428770005',
    '18123650700',
    '13585601203',
    '15093322321',
    '13911198542',
    '18625356660',
    '15876502263',
    '13510453356',
    '18473445336',
    '13902261014',
    '15220051011',
    '15288138727',
    '13918416691',
    '13918866664',
    '13761139822',
    '13691278421',
    '18666210101',
    '13636670059',
    '13776627791',
    '13700578888',
    '15800042265',
    '18611073083',
    '13621380345',
    '18672999804',
    '15910512262',
    '13916115060',
    '18752090645',
    '13570386224',
    '13816786966',
    '15989106503',
    '18317042352',
    '15810614930',
    '15202178266',
    '18516576268',
    '13923443557',
    '13603077702',
    '18665928834',
    '15018504763'
  ]

  const content = '【中信银行】特邀您领取全球白金卡，188种任你选，不查征信，最高20万额度，可提现，领取 http://c7.gg/cd8Ph 退订回T'

  logger.info('领创盛世短信发送记录: 号码个数【', mobiles.length, '】, 短信内容【', content, '】')

  await LCSSSmsUtil.sendSMS({
    mobiles,
    content
  })

  // await testSendMail(fastify)

  // await testRedis(fastify)

  // console.log('moment start timestamp =', moment(`2018-06-01 00:00:00`, 'YYYY-MM-DD HH:mm:ss').valueOf())
  // console.log('moment end timestamp =', moment(`2018-07-01 00:00:00`, 'YYYY-MM-DD HH:mm:ss').valueOf())

  // await requestUtil.sendRequest({
  //   port: 8911,
  //   url: '/mail/send',
  //   method: 'post',
  //   multipart: true,
  //   params: {
  //     files: [
  //       // fs.createReadStream('/Users/shupeipei/DeskTop/test1.xlsx'),
  //       // more file.
  //     ],
  //     to: '576507045@qq.com'
  //   }
  // })
}
